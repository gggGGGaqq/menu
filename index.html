<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Меню ресторана</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
            user-select: none; /* Запрещает выделение текста */
            -webkit-user-select: none; /* Для Safari */
            -moz-user-select: none; /* Для Firefox */
            -ms-user-select: none; /* Для Internet Explorer */
        }

        body {
            background: #1e1e2f;
            color: #ffffff;
            overflow-x: hidden;
        }

        header {
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            padding: 20px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0px 4px 10px rgba(255, 126, 95, 0.5);
            position: relative; /* Для позиционирования кнопки корзины */
        }

        /* Кнопка "Назад" - без изменений */
        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: #ffffff;
            color: #ff7e5f;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        .back-button:hover { background: #e0e0e0; }

        /* --- НОВОЕ: Кнопка корзины в шапке --- */
        .cart-button {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: #ffffff;
            color: #ff7e5f;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .cart-button:hover {
             background: #e0e0e0;
             transform: translateY(-50%) scale(1.05);
        }
        #cart-count { /* Счетчик товаров */
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            vertical-align: top;
            margin-left: 5px;
        }
        /* ------------------------------------- */

        /* Информация о ресторане - без изменений */
        .restaurant-info { /* ... стили ... */ }
        .restaurant-info h2 { /* ... стили ... */ }
        .restaurant-info p { /* ... стили ... */ }
        a { /* ... стили ... */ }
        a:focus, a:active { /* ... стили ... */ }
        .language-btn { /* ... стили ... */ }
        @media (max-width: 768px) { .language-btn { /* ... стили ... */ }}

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }

        /* Фильтры и Поиск - без изменений */
        .filters { /* ... стили ... */ }
        .filters::-webkit-scrollbar { /* ... стили ... */ }
        .filters::-webkit-scrollbar-thumb { /* ... стили ... */ }
        .filter-btn { /* ... стили ... */ }
        .filter-btn:hover, .filter-btn.active { /* ... стили ... */ }
        .search-box { /* ... стили ... */ }
        .search-box input { /* ... стили ... */ }

        /* Меню */
        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .menu-item {
            background: #28293d;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s ease-in-out;
            display: flex; /* Используем flex для удобного расположения кнопки */
            flex-direction: column; /* Элементы в столбик */
            justify-content: space-between; /* Распределяем пространство */
        }
        .menu-item:hover { transform: scale(1.03); }
        .menu-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            cursor: pointer; /* Добавляем курсор для клика по картинке/названию */
            margin-bottom: 10px; /* Отступ снизу картинки */
        }
        .menu-item h3 {
             cursor: pointer; /* Добавляем курсор для клика по картинке/названию */
             margin-bottom: 5px;
        }
         .menu-item p {
             margin-bottom: 10px; /* Отступ для описания и цены */
             flex-grow: 1; /* Позволяем описанию занимать доступное место */
         }
         .menu-item .price {
            font-weight: bold;
            color: gold;
            margin-bottom: 15px; /* Отступ перед кнопкой */
         }

        /* --- НОВОЕ: Кнопка "В корзину" --- */
        .add-to-cart-btn {
            background: linear-gradient(135deg, #5f9eff, #7b94eb); /* Синий градиент */
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: 0.3s;
            width: 100%; /* Кнопка на всю ширину карточки */
            margin-top: auto; /* Прижимаем кнопку к низу */
        }
        .add-to-cart-btn:hover {
            background: linear-gradient(135deg, #4a80d1, #627acc); /* Темнее при наведении */
            transform: scale(1.02);
        }
        /* ------------------------------------- */

        /* Медиа-запросы для меню - без изменений */
        @media (max-width: 768px) { /* ... стили ... */ }

        /* Модальное окно (общее) */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex; /* Используем flex для центрирования */
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0; /* Начальная прозрачность */
            visibility: hidden; /* Начально скрыто */
            transition: opacity 0.3s ease, visibility 0.3s ease; /* Плавное появление */
        }
        /* Показываем модальное окно */
        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        /* Контент модального окна (детали блюда) */
        .modal-content {
            background: #28293d;
            color: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(255, 126, 95, 0.5);
            position: relative; /* Для позиционирования кнопки закрытия */
        }
        .modal-content img { /* ... стили ... */ }
        /* Добавим кнопку закрытия для модальных окон */
         .close-modal-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #555;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            line-height: 30px; /* Центрируем крестик */
            text-align: center;
         }
         .close-modal-btn:hover { background: #777;}


        /* --- НОВОЕ: Стили для модального окна корзины --- */
        .cart-modal .modal-content { /* Отдельные стили для контента корзины */
            max-width: 600px; /* Корзина может быть шире */
            text-align: left; /* Текст влево для списка */
        }
        .cart-modal h2 {
            text-align: center; /* Заголовок по центру */
            margin-bottom: 20px;
            color: #ffb47b;
        }
        #cart-items {
            margin-bottom: 20px;
            max-height: 40vh; /* Ограничиваем высоту списка */
            overflow-y: auto; /* Добавляем скролл, если много товаров */
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #444;
        }
        .cart-item:last-child { border-bottom: none; }
        .cart-item-info { flex-grow: 1; margin: 0 10px; }
        .cart-item-info h4 { margin-bottom: 5px; }
        .cart-item img { /* Маленькая картинка в корзине */
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
        }
        .cart-quantity button {
            background: #555;
            color: white;
            border: none;
            border-radius: 4px;
            width: 25px;
            height: 25px;
            cursor: pointer;
            margin: 0 5px;
        }
        .cart-quantity button:hover { background: #777; }
        .cart-remove-btn {
             background: #ff5f5f;
             color: white;
             border: none;
             border-radius: 4px;
             padding: 5px 10px;
             cursor: pointer;
        }
         .cart-remove-btn:hover { background: #e04a4a; }

        #cart-total {
             font-weight: bold;
             font-size: 1.2em;
             color: gold;
        }
        .cart-actions {
            text-align: right;
            margin-top: 20px;
        }
        /* ------------------------------------------------ */

        /* Анимация падающих блюд - без изменений */
        .falling-food { /* ... стили ... */ }
        @keyframes fall { /* ... стили ... */ }
    </style>
</head>
<body>
    <header>
        <h1 data-lang="header">Меню ресторана</h1>
        <button id="cart-button" class="cart-button">
            🛒 <span data-lang="cart_btn">Корзина</span> (<span id="cart-count">0</span>)
        </button>
        <div class="restaurant-info">
             <button onclick="changeLanguage('ru')" class="language-btn">🇷🇺 Русский</button>
            <button onclick="changeLanguage('kk')" class="language-btn">🇰🇿 Қазақша</button>
        </div>
    </header>

    <div class="container">
        <div class="search-box">
            <input type="text" id="search" data-lang="poisk" placeholder="Поиск блюда...">
        </div>
        <div class="filters">
            <button class="filter-btn active" data-category="all" data-lang="category">Все</button>
            <button class="filter-btn" data-category="starters" data-lang="category2">Закуски</button>
            <button class="filter-btn" data-category="main" data-lang="category3">Основные блюда</button>
            <button class="filter-btn" data-category="desserts" data-lang="category4">Десерты</button>
            <button class="filter-btn" data-category="drinks" data-lang="category5">Напитки</button>
        </div>
        <div class="menu" id="menu">
            </div>
    </div>

    <div id="details-modal" class="modal">
        <div class="modal-content" id="details-modal-content">
            <button class="close-modal-btn" onclick="closeModal('details-modal')">×</button>
        </div>
    </div>

    <div id="cart-modal" class="modal cart-modal">
         <div class="modal-content">
             <button class="close-modal-btn" onclick="closeModal('cart-modal')">×</button>
             <h2 data-lang="cart_title">Корзина</h2>
             <div id="cart-items">
                 </div>
             <div class="cart-summary">
                <p><strong><span data-lang="cart_total">Итого:</span></strong> <span id="cart-total">0₸</span></p>
             </div>
             <div class="cart-actions">
                 <button class="filter-btn" onclick="closeModal('cart-modal')" data-lang="cart_close">Закрыть</button>
                 </div>
         </div>
    </div>


    <script>
        // --- Глобальные переменные и данные ---
        const menuItems = [
            // Добавьте сюда больше блюд
            { id: 1, name: "Суп", category: "starters", img: "images/soup.jpg", desc: "Горячий ароматный суп.", ingredients: "Вода, овощи, специи", time: "30 мин", price: "1200₸", weight: "350г" },
            { id: 2, name: "Шашлык", category: "main", img: "images/kebab.jpg", desc: "Сочный мясной шашлык.", ingredients: "Мясо, лук, специи", time: "45 мин", price: "2500₸", weight: "400г" },
            { id: 3, name: "Торт", category: "desserts", img: "images/cake.jpg", desc: "Сладкий и вкусный торт.", ingredients: "Мука, сахар, яйца", time: "1 час", price: "3000₸", weight: "500г" },
            { id: 4, name: "Чай", category: "drinks", img: "images/tea.jpg", desc: "Ароматный свежий чай.", ingredients: "Чайные листья, вода", time: "5 мин", price: "500₸", weight: "250мл" }
            // Добавьте уникальный 'id' для каждого блюда
        ];

        const menuContainer = document.getElementById("menu");
        const filterButtons = document.querySelectorAll(".filter-btn");
        const searchInput = document.getElementById("search");
        const cartButton = document.getElementById("cart-button");
        const cartCountSpan = document.getElementById("cart-count");
        const cartItemsContainer = document.getElementById("cart-items");
        const cartTotalSpan = document.getElementById("cart-total");
        const detailsModal = document.getElementById("details-modal");
        const detailsModalContent = document.getElementById("details-modal-content");
        const cartModal = document.getElementById("cart-modal");

        let currentCategory = "all";
        let currentSearch = "";
        // Загружаем корзину из localStorage или создаем пустую
        let cart = JSON.parse(localStorage.getItem('shoppingCart')) || [];

        // --- Функции ---

        // Вспомогательная функция для парсинга цены (из "1200₸" в 1200)
        function parsePrice(priceString) {
            return parseInt(priceString.replace(/[^0-9]/g, ''), 10) || 0;
        }

        // Вспомогательная функция для форматирования цены (из 1200 в "1200₸")
        function formatPrice(priceNumber) {
            return `${priceNumber}₸`;
        }

        // Функция перевода текста
        let translations = {}; // Хранилище для текущих переводов
        function changeLanguage(lang) {
            fetch(`lang/${lang}.json`)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    translations = data; // Сохраняем переводы
                    document.querySelectorAll("[data-lang]").forEach(element => {
                        const key = element.getAttribute("data-lang");
                        if (data[key]) {
                            // Обновляем текст или плейсхолдер
                            if (element.tagName === 'INPUT' && element.placeholder) {
                                element.placeholder = data[key];
                            } else {
                                element.textContent = data[key];
                            }
                        }
                    });
                    // Обновляем меню и корзину, чтобы перевести динамические тексты
                    renderMenu();
                    renderCart();
                    localStorage.setItem("lang", lang);
                })
                .catch(error => {
                    console.error("Could not load language file:", error);
                    // Возможно, стоит загрузить язык по умолчанию или показать ошибку
                    if (lang !== 'ru') changeLanguage('ru'); // Пытаемся загрузить русский как запасной
                });
        }


        // Отображение меню
        function renderMenu() {
            let filteredItems = menuItems;

            // Фильтрация по категории
            if (currentCategory !== "all") {
                filteredItems = filteredItems.filter(item => item.category === currentCategory);
            }

            // Фильтрация по поиску
            if (currentSearch.trim() !== "") {
                const searchTerm = currentSearch.toLowerCase();
                filteredItems = filteredItems.filter(item =>
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.desc.toLowerCase().includes(searchTerm) // Искать и в описании
                );
            }

            menuContainer.innerHTML = filteredItems.length ? filteredItems.map(item => {
                 // Определяем текст для кнопки "В корзину" на текущем языке
                const addToCartText = translations['add_to_cart'] || "В корзину"; // Запасной текст

                return `
                <div class="menu-item" data-id="${item.id}">
                    <div> <img src="${item.img}" alt="${item.name}" onclick="openDetailsModal(${item.id})">
                        <h3 onclick="openDetailsModal(${item.id})">${item.name}</h3>
                        <p>${item.desc}</p>
                        <p class="price"><strong>${translations['price'] || 'Цена'}:</strong> ${item.price}</p>
                    </div>
                    <button class="add-to-cart-btn" data-id="${item.id}">${addToCartText}</button>
                </div>
            `}).join("") : `<p style="text-align: center; font-size: 18px;">${translations['not_found'] || 'Ничего не найдено'}</p>`;

            // Добавляем обработчики на новые кнопки "В корзину"
            addCartButtonListeners();
        }

        // Добавление обработчиков на кнопки "В корзину" (используем делегирование)
        function addCartButtonListeners() {
             menuContainer.querySelectorAll('.add-to-cart-btn').forEach(button => {
                 // Удаляем старый обработчик, если он был, чтобы избежать дублирования
                 button.replaceWith(button.cloneNode(true));
             });
             // Добавляем новый обработчик на контейнер
             menuContainer.addEventListener('click', handleMenuClick);
        }

        function handleMenuClick(event) {
            if (event.target.classList.contains('add-to-cart-btn')) {
                const button = event.target;
                const id = parseInt(button.dataset.id);
                const item = menuItems.find(mItem => mItem.id === id);
                if (item) {
                    addToCart(item);
                    // Простая анимация для обратной связи
                    button.style.transform = 'scale(0.95)';
                    setTimeout(() => button.style.transform = 'scale(1)', 150);
                }
            }
        }


        // Открытие модального окна с деталями
        function openDetailsModal(id) {
            const item = menuItems.find(item => item.id === id);
            if (!item) return;

             // Перевод ключей
            const ingredientsLabel = translations['ingredients'] || 'Состав';
            const timeLabel = translations['time'] || 'Время приготовления';
            const weightLabel = translations['weight'] || 'Вес';
            const priceLabel = translations['price'] || 'Цена';

            detailsModalContent.innerHTML = `
                <button class="close-modal-btn" onclick="closeModal('details-modal')">×</button>
                <img src="${item.img}" alt="${item.name}">
                <h2>${item.name}</h2>
                <p>${item.desc}</p>
                <p><strong>${ingredientsLabel}:</strong> ${item.ingredients}</p>
                <p><strong>${timeLabel}:</strong> ${item.time}</p>
                <p><strong>${weightLabel}:</strong> ${item.weight}</p>
                <p><strong>${priceLabel}:</strong> ${item.price}</p>
            `;
            detailsModal.classList.add('show');
        }

        // Закрытие любого модального окна
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Закрытие модального окна при клике вне его
         window.addEventListener('click', (event) => {
             if (event.target.classList.contains('modal')) {
                 closeModal(event.target.id);
             }
         });


        // --- Функциональность корзины ---

        // Добавление товара в корзину
        function addToCart(item) {
            const existingItem = cart.find(cartItem => cartItem.id === item.id);
            const itemPrice = parsePrice(item.price); // Получаем числовое значение цены

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: item.id,
                    name: item.name,
                    price: itemPrice, // Сохраняем числовую цену
                    img: item.img,
                    quantity: 1
                });
            }
            saveCart();
            updateCartUI();
            console.log("Cart:", cart); // Для отладки
        }

        // Изменение количества товара
        function changeQuantity(id, change) {
            const itemIndex = cart.findIndex(cartItem => cartItem.id === id);
            if (itemIndex > -1) {
                cart[itemIndex].quantity += change;
                if (cart[itemIndex].quantity <= 0) {
                    // Удаляем товар, если количество стало 0 или меньше
                    cart.splice(itemIndex, 1);
                }
                saveCart();
                updateCartUI();
            }
        }

        // Удаление товара из корзины
        function removeFromCart(id) {
             cart = cart.filter(cartItem => cartItem.id !== id);
             saveCart();
             updateCartUI();
        }

        // Расчет общей суммы корзины
        function calculateTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        // Сохранение корзины в localStorage
        function saveCart() {
            localStorage.setItem('shoppingCart', JSON.stringify(cart));
        }

        // Обновление UI корзины (счетчик + рендер содержимого)
        function updateCartUI() {
             renderCart();
             updateCartCount();
        }

        // Обновление счетчика на иконке корзины
        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCountSpan.textContent = totalItems;
        }

        // Отображение содержимого корзины в модальном окне
        function renderCart() {
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `<p style="text-align:center;">${translations['cart_empty'] || 'Корзина пуста'}</p>`;
            } else {
                 // Переводы кнопок
                const removeText = translations['cart_remove'] || 'Удалить';

                cartItemsContainer.innerHTML = cart.map(item => `
                    <div class="cart-item">
                         <img src="${item.img}" alt="${item.name}">
                         <div class="cart-item-info">
                             <h4>${item.name}</h4>
                             <p>${formatPrice(item.price)} x ${item.quantity} = ${formatPrice(item.price * item.quantity)}</p>
                         </div>
                         <div class="cart-quantity">
                             <button onclick="changeQuantity(${item.id}, -1)">-</button>
                             <span>${item.quantity}</span>
                             <button onclick="changeQuantity(${item.id}, 1)">+</button>
                         </div>
                         <button class="cart-remove-btn" onclick="removeFromCart(${item.id})">${removeText}</button>
                    </div>
                `).join('');
            }
            // Обновляем общую сумму
            cartTotalSpan.textContent = formatPrice(calculateTotal());
        }

        // Открытие модального окна корзины
        function openCartModal() {
            renderCart(); // Обновляем содержимое перед показом
            cartModal.classList.add('show');
        }


        // --- Анимация падающих блюд ---
        function createFallingFood() {
            const foodEmojis = ["🍕", "🍔", "🍣", "🍩", "🥗", "🍗", "🥞", "🌮"];
            setInterval(() => {
                const food = document.createElement("div");
                food.classList.add("falling-food");
                food.innerText = foodEmojis[Math.floor(Math.random() * foodEmojis.length)];
                food.style.left = `${Math.random() * 100}vw`;
                food.style.animationDuration = `${Math.random() * 10 + 5}s`;
                document.body.appendChild(food);
                setTimeout(() => food.remove(), 16000);
            }, 1000);
        }

        // --- Инициализация при загрузке страницы ---
        document.addEventListener("DOMContentLoaded", () => {
            // Загрузка языка
            const savedLang = localStorage.getItem("lang") || "ru"; // По умолчанию русский
            changeLanguage(savedLang); // Загружаем язык и рендерим меню/корзину

            // Фильтры
            filterButtons.forEach(button => {
                button.addEventListener("click", () => {
                    filterButtons.forEach(btn => btn.classList.remove("active"));
                    button.classList.add("active");
                    currentCategory = button.dataset.category;
                    renderMenu();
                });
            });

            // Поиск
            searchInput.addEventListener("input", (e) => {
                currentSearch = e.target.value;
                renderMenu();
            });

            // Кнопка корзины
            cartButton.addEventListener("click", openCartModal);

            // Инициализация UI корзины
            updateCartUI();

            // Запуск анимации
            createFallingFood();

             // Изначальный рендер меню (произойдет внутри changeLanguage)
             // renderMenu();
        });

    </script>
</body>
</html>
